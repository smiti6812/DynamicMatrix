name: workflow-with-dynamic_matrix
on:
  workflow_dispatch:

jobs:
  prepare:
    runs-on: windows-latest
    outputs:
      repository: ${{ steps.json.outputs.repository }}
    steps:
      - name: build matrix
        id: json        
        run: |       
          $repository='{"repository": ["..\\repo1.sln","..\\repo2.sln","..\\repo3.sln","..\\repo4.sln"] }'
          echo "repository=$repository" >> "$ENV:GITHUB_OUTPUT"

  run-matrix:
    needs: prepare
    runs-on: windows-latest
    strategy:
      fail-fast: false
      max-parallel: 1
      matrix: ${{ fromJson(needs.prepare.outputs.repository) }}
    steps:
      - run: echo "${{ matrix.repository }}"
